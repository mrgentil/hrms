generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model application {
  id               Int                @id @default(autoincrement())
  reason           String?            @db.VarChar(255)
  start_date       DateTime           @db.DateTime(0)
  end_date         DateTime           @db.DateTime(0)
  status           application_status @default(Pending)
  type             application_type
  user_id          Int
  approver_user_id Int?
  approved_at      DateTime?          @db.DateTime(0)
  workflow_step    String?            @db.VarChar(255)
  approver_comment String?            @db.Text
  leave_type_id    Int?
  created_at       DateTime           @db.DateTime(0)
  updated_at       DateTime           @db.DateTime(0)
  user             user               @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "application_ibfk_303")
  leave_type       leave_type?        @relation(fields: [leave_type_id], references: [id], map: "application_ibfk_304")
  leave_messages   leave_message[]

  @@index([leave_type_id], map: "leave_type_id")
  @@index([user_id], map: "user_id")
}

model leave_message {
  id             Int         @id @default(autoincrement())
  application_id Int
  author_user_id Int
  message        String      @db.Text
  created_at     DateTime    @default(now()) @db.DateTime(0)
  application    application @relation(fields: [application_id], references: [id], onDelete: Cascade, map: "leave_message_ibfk_application")
  author         user        @relation("user_leave_messages", fields: [author_user_id], references: [id], onDelete: Cascade, map: "leave_message_ibfk_author")

  @@index([application_id], map: "leave_message_application_id")
  @@index([author_user_id], map: "leave_message_author_user_id")
}

model conversation {
  id                       Int                        @id @default(autoincrement())
  name                     String?                    @db.VarChar(255)
  is_group                 Boolean                    @default(false)
  created_by_user_id       Int
  created_at               DateTime                   @db.DateTime(0)
  updated_at               DateTime                   @db.DateTime(0)
  user                     user                       @relation(fields: [created_by_user_id], references: [id], onDelete: NoAction, map: "conversation_ibfk_1")
  conversation_participant conversation_participant[]
  user_message             user_message[]

  @@index([created_by_user_id], map: "created_by_user_id")
}

model conversation_participant {
  id              Int          @id @default(autoincrement())
  joined_at       DateTime     @db.DateTime(0)
  left_at         DateTime?    @db.DateTime(0)
  created_at      DateTime     @db.DateTime(0)
  updated_at      DateTime     @db.DateTime(0)
  conversation_id Int
  user_id         Int
  conversation    conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade, map: "conversation_participant_ibfk_285")
  user            user         @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "conversation_participant_ibfk_286")

  @@unique([conversation_id, user_id], map: "conversation_participant_user_id_conversation_id_unique")
  @@index([user_id], map: "user_id")
}

model department {
  id                                    Int                       @id @default(autoincrement())
  department_name                       String                    @db.VarChar(255)
  manager_user_id                       Int?
  parent_department_id                  Int?
  organization_id                       Int?
  created_at                            DateTime                  @db.DateTime(0)
  updated_at                            DateTime                  @db.DateTime(0)
  announcements                         announcement[]
  user_department_manager_user_idTouser user?                     @relation("department_manager_user_idTouser", fields: [manager_user_id], references: [id], map: "department_ibfk_321")
  department                            department?               @relation("departmentTodepartment", fields: [parent_department_id], references: [id], map: "department_ibfk_322")
  other_department                      department[]              @relation("departmentTodepartment")
  department_announcement               department_announcement[]
  expense                               expense[]
  user_user_department_idTodepartment   user[]                    @relation("user_department_idTodepartment")

  @@index([manager_user_id], map: "manager_user_id")
  @@index([parent_department_id], map: "parent_department_id")
}

model department_announcement {
  id                       Int         @id @default(autoincrement())
  announcement_title       String      @db.VarChar(255)
  announcement_description String?     @db.VarChar(255)
  created_at               DateTime    @db.DateTime(0)
  created_by_user_id       Int
  department_id            Int?
  user                     user        @relation(fields: [created_by_user_id], references: [id], onDelete: Cascade, map: "department_announcement_ibfk_307")
  department               department? @relation(fields: [department_id], references: [id], map: "department_announcement_ibfk_308")

  @@index([created_by_user_id], map: "created_by_user_id")
  @@index([department_id], map: "department_id")
}

model employment_contract {
  id                 Int                               @id @default(autoincrement())
  contract_type      employment_contract_contract_type
  start_date         DateTime                          @db.DateTime(0)
  end_date           DateTime?                         @db.DateTime(0)
  probation_end_date DateTime?                         @db.DateTime(0)
  status             employment_contract_status        @default(DRAFT)
  weekly_hours       Float?                            @db.Float
  notes              String?                           @db.Text
  created_at         DateTime                          @db.DateTime(0)
  updated_at         DateTime                          @db.DateTime(0)
  user_id            Int
  user               user                              @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "employment_contract_ibfk_1")

  @@index([user_id], map: "user_id")
}

model expense {
  id                 Int        @id @default(autoincrement())
  expense_item_name  String     @db.VarChar(255)
  expense_item_store String     @db.VarChar(255)
  date               DateTime   @db.DateTime(0)
  amount             Int
  department_id      Int
  user_id            Int?
  department         department @relation(fields: [department_id], references: [id], onDelete: NoAction, map: "expense_ibfk_291")
  user               user?      @relation(fields: [user_id], references: [id], map: "expense_ibfk_292")

  @@index([department_id], map: "department_id")
  @@index([user_id], map: "user_id")
}

model job {
  id         Int       @id @default(autoincrement())
  job_title  String    @db.VarChar(255)
  start_date DateTime  @db.DateTime(0)
  end_date   DateTime  @db.DateTime(0)
  user_id    Int
  user       user      @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "job_ibfk_1")
  payment    payment[]

  @@index([user_id], map: "user_id")
}

model leave_balance {
  id                Int        @id @default(autoincrement())
  year              Int
  days_accrued      Float      @default(0) @db.Float
  days_used         Float      @default(0) @db.Float
  days_carried_over Float      @default(0) @db.Float
  created_at        DateTime   @db.DateTime(0)
  updated_at        DateTime   @db.DateTime(0)
  user_id           Int
  leave_type_id     Int
  user              user       @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "leave_balance_ibfk_297")
  leave_type        leave_type @relation(fields: [leave_type_id], references: [id], onDelete: Cascade, map: "leave_balance_ibfk_298")

  @@index([leave_type_id], map: "leave_type_id")
  @@index([user_id], map: "user_id")
}

model leave_type {
  id                Int             @id @default(autoincrement())
  name              String          @db.VarChar(255)
  description       String?         @db.Text
  requires_approval Boolean         @default(true)
  default_allowance Float?          @db.Float
  monthly_allowance Float?          @db.Float
  created_at        DateTime        @db.DateTime(0)
  updated_at        DateTime        @db.DateTime(0)
  application       application[]
  leave_balance     leave_balance[]
}

model payment {
  id             Int                  @id @default(autoincrement())
  payment_type   payment_payment_type
  payment_month  DateTime             @db.DateTime(0)
  payment_date   DateTime             @db.DateTime(0)
  payment_fine   Int?
  payment_amount Int
  comments       String?              @db.VarChar(255)
  job_id         Int?
  job            job?                 @relation(fields: [job_id], references: [id], onDelete: Cascade, map: "payment_ibfk_1")

  @@index([job_id], map: "job_id")
}

model permission {
  id              Int               @id @default(autoincrement())
  name            String            @unique(map: "name") @db.VarChar(255)
  description     String?           @db.Text
  group_name      String?           @db.VarChar(100)
  group_icon      String?           @db.VarChar(10)
  label           String?           @db.VarChar(255)
  sort_order      Int               @default(0)
  created_at      DateTime          @db.DateTime(0)
  updated_at      DateTime          @db.DateTime(0)
  role_permission role_permission[]
  menu_items      menu_item[]
}

model menu_item {
  id            Int         @id @default(autoincrement())
  name          String      @db.VarChar(255)
  path          String?     @db.VarChar(255)
  icon          String?     @db.VarChar(50)
  parent_id     Int?
  permission_id Int?
  sort_order    Int         @default(0)
  is_active     Boolean     @default(true)
  section       String      @default("main") @db.VarChar(100)
  description   String?     @db.VarChar(255)
  created_at    DateTime    @db.DateTime(0)
  updated_at    DateTime    @db.DateTime(0)
  parent        menu_item?  @relation("menu_hierarchy", fields: [parent_id], references: [id], onDelete: SetNull)
  children      menu_item[] @relation("menu_hierarchy")
  permission    permission? @relation(fields: [permission_id], references: [id], onDelete: SetNull)

  @@index([parent_id], map: "menu_item_parent_id")
  @@index([permission_id], map: "menu_item_permission_id")
}

model position {
  id          Int      @id @default(autoincrement())
  title       String   @db.VarChar(255)
  level       String?  @db.VarChar(255)
  description String?  @db.Text
  created_at  DateTime @db.DateTime(0)
  updated_at  DateTime @db.DateTime(0)
  user        user[]
}

model project {
  id             Int              @id @default(autoincrement())
  name           String           @db.VarChar(255)
  description    String?          @db.Text
  status         project_status   @default(PLANNED)
  start_date     DateTime?        @db.DateTime(0)
  end_date       DateTime?        @db.DateTime(0)
  owner_user_id  Int?
  created_at     DateTime         @db.DateTime(0)
  updated_at     DateTime         @db.DateTime(0)
  user           user?            @relation(fields: [owner_user_id], references: [id], map: "project_ibfk_1")
  project_member project_member[]
  project_tags   project_tag[]
  task           task[]
  task_board     task_board[]
  task_templates task_template[]

  @@index([owner_user_id], map: "owner_user_id")
}

model project_member {
  id         Int      @id @default(autoincrement())
  role       String?  @db.VarChar(255)
  created_at DateTime @db.DateTime(0)
  updated_at DateTime @db.DateTime(0)
  user_id    Int
  project_id Int
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "project_member_ibfk_279")
  project    project  @relation(fields: [project_id], references: [id], onDelete: Cascade, map: "project_member_ibfk_280")

  @@unique([user_id, project_id], map: "project_member_project_id_user_id_unique")
  @@index([project_id], map: "project_id")
}

model role {
  id              Int               @id @default(autoincrement())
  name            String            @unique(map: "name") @db.VarChar(255)
  description     String?           @db.Text
  permissions     Json?
  color           String?           @db.VarChar(7)
  icon            String?           @db.VarChar(10)
  is_system       Boolean           @default(false)
  created_at      DateTime          @db.DateTime(0)
  updated_at      DateTime          @db.DateTime(0)
  role_permission role_permission[]
  users           user[]
  user_role       user_role[]
}

model role_permission {
  id            Int         @id @default(autoincrement())
  created_at    DateTime    @db.DateTime(0)
  updated_at    DateTime    @db.DateTime(0)
  role_id       Int?
  permission_id Int?
  role          role?       @relation(fields: [role_id], references: [id], onDelete: Cascade, map: "role_permission_ibfk_123")
  permission    permission? @relation(fields: [permission_id], references: [id], onDelete: Cascade, map: "role_permission_ibfk_124")

  @@unique([role_id, permission_id], map: "role_permission_permission_id_role_id_unique")
  @@index([permission_id], map: "permission_id")
}

model task {
  id                                 Int               @id @default(autoincrement())
  title                              String            @db.VarChar(255)
  description                        String?           @db.Text
  status                             task_status       @default(TODO)
  priority                           task_priority     @default(MEDIUM)
  start_date                         DateTime?         @db.DateTime(0)
  due_date                           DateTime?         @db.DateTime(0)
  completed_at                       DateTime?         @db.DateTime(0)
  created_by_user_id                 Int
  updated_by_user_id                 Int?
  created_at                         DateTime          @db.DateTime(0)
  updated_at                         DateTime          @db.DateTime(0)
  task_column_id                     Int
  project_id                         Int
  parent_task_id                     Int?
  estimated_hours                    Decimal?          @db.Decimal(8, 2)
  is_recurring                       Boolean           @default(false)
  recurrence_rule                    String?           @db.VarChar(255)
  recurrence_end_date                DateTime?         @db.DateTime(0)
  recurring_parent_id                Int?
  user_task_created_by_user_idTouser user              @relation("task_created_by_user_idTouser", fields: [created_by_user_id], references: [id], onDelete: Cascade, map: "task_ibfk_548")
  user_task_updated_by_user_idTouser user?             @relation("task_updated_by_user_idTouser", fields: [updated_by_user_id], references: [id], map: "task_ibfk_549")
  task_column                        task_column       @relation(fields: [task_column_id], references: [id], onDelete: Cascade, map: "task_ibfk_550")
  project                            project           @relation(fields: [project_id], references: [id], onDelete: Cascade, map: "task_ibfk_551")
  parent_task                        task?             @relation("subtasks", fields: [parent_task_id], references: [id])
  subtasks                           task[]            @relation("subtasks")
  recurring_parent                   task?             @relation("RecurringTasks", fields: [recurring_parent_id], references: [id])
  recurring_instances                task[]            @relation("RecurringTasks")
  task_activities                    task_activity[]
  task_assignment                    task_assignment[]
  task_attachments                   task_attachment[]
  task_checklists                    task_checklist[]
  task_comments                      task_comment[]
  depended_by                        task_dependency[] @relation("TaskDependedBy")
  dependencies                       task_dependency[] @relation("TaskDependencies")
  task_tags                          task_tag[]
  time_entries                       task_time_entry[]

  @@index([created_by_user_id], map: "created_by_user_id")
  @@index([project_id], map: "project_id")
  @@index([task_column_id], map: "task_column_id")
  @@index([updated_by_user_id], map: "updated_by_user_id")
  @@index([parent_task_id], map: "parent_task_id")
  @@index([recurring_parent_id], map: "task_recurring_parent_id_fkey")
}

model task_assignment {
  id          Int      @id @default(autoincrement())
  role        String?  @db.VarChar(255)
  assigned_at DateTime @db.DateTime(0)
  created_at  DateTime @db.DateTime(0)
  updated_at  DateTime @db.DateTime(0)
  user_id     Int
  task_id     Int
  user        user     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "task_assignment_ibfk_271")
  task        task     @relation(fields: [task_id], references: [id], onDelete: Cascade, map: "task_assignment_ibfk_272")

  @@index([task_id], map: "task_id")
  @@index([user_id], map: "user_id")
}

model task_board {
  id          Int           @id @default(autoincrement())
  name        String        @db.VarChar(255)
  created_at  DateTime      @db.DateTime(0)
  updated_at  DateTime      @db.DateTime(0)
  project_id  Int
  project     project       @relation(fields: [project_id], references: [id], onDelete: Cascade, map: "task_board_ibfk_1")
  task_column task_column[]

  @@index([project_id], map: "project_id")
}

model task_column {
  id            Int        @id @default(autoincrement())
  name          String     @db.VarChar(255)
  sort_order    Int        @default(0)
  created_at    DateTime   @db.DateTime(0)
  updated_at    DateTime   @db.DateTime(0)
  task_board_id Int
  task          task[]
  task_board    task_board @relation(fields: [task_board_id], references: [id], onDelete: Cascade, map: "task_column_ibfk_1")

  @@index([task_board_id], map: "task_board_id")
}

model task_comment {
  id                Int                    @id @default(autoincrement())
  content           String                 @db.Text
  content_html      String?                @db.Text
  task_id           Int
  user_id           Int
  parent_comment_id Int?
  is_pinned         Boolean                @default(false)
  is_resolved       Boolean                @default(false)
  resolved_by       Int?
  resolved_at       DateTime?              @db.DateTime(0)
  created_at        DateTime               @db.DateTime(0)
  updated_at        DateTime               @db.DateTime(0)
  attachments       task_attachment[]      @relation("CommentAttachments")
  parent_comment    task_comment?          @relation("CommentReplies", fields: [parent_comment_id], references: [id], onDelete: Cascade)
  replies           task_comment[]         @relation("CommentReplies")
  task              task                   @relation(fields: [task_id], references: [id], onDelete: Cascade)
  user              user                   @relation("CommentAuthor", fields: [user_id], references: [id], onDelete: Cascade)
  resolver          user?                  @relation("CommentResolver", fields: [resolved_by], references: [id])
  reactions         comment_reaction[]
  edit_history      comment_edit_history[]

  @@index([task_id], map: "task_comment_task_id")
  @@index([user_id], map: "task_comment_user_id")
  @@index([parent_comment_id], map: "task_comment_parent_id")
  @@index([is_pinned], map: "task_comment_is_pinned")
  @@index([is_resolved], map: "task_comment_is_resolved")
  @@index([resolved_by], map: "task_comment_resolved_by")
}

model comment_reaction {
  id         Int          @id @default(autoincrement())
  comment_id Int
  user_id    Int
  emoji      String       @db.VarChar(10)
  created_at DateTime     @default(now()) @db.DateTime(0)
  comment    task_comment @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  user       user         @relation("UserCommentReactions", fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([comment_id, user_id, emoji])
  @@index([comment_id], map: "comment_reaction_comment_id")
  @@index([user_id], map: "comment_reaction_user_id")
}

model comment_edit_history {
  id          Int          @id @default(autoincrement())
  comment_id  Int
  user_id     Int
  old_content String       @db.Text
  new_content String       @db.Text
  edited_at   DateTime     @default(now()) @db.DateTime(0)
  comment     task_comment @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  user        user         @relation("UserCommentEdits", fields: [user_id], references: [id])

  @@index([comment_id], map: "comment_edit_history_comment_id")
  @@index([user_id], map: "comment_edit_history_user_id")
}

model task_attachment {
  id             Int           @id @default(autoincrement())
  file_name      String        @db.VarChar(255)
  file_path      String        @db.VarChar(500)
  file_size      Int?
  file_type      String?       @db.VarChar(100)
  thumbnail_path String?       @db.VarChar(500)
  preview_url    String?       @db.VarChar(500)
  task_id        Int
  uploaded_by    Int
  comment_id     Int?
  created_at     DateTime      @db.DateTime(0)
  comment        task_comment? @relation("CommentAttachments", fields: [comment_id], references: [id], onDelete: Cascade)
  task           task          @relation(fields: [task_id], references: [id], onDelete: Cascade)
  user           user          @relation(fields: [uploaded_by], references: [id], onDelete: Cascade)

  @@index([task_id], map: "task_attachment_task_id")
  @@index([uploaded_by], map: "task_attachment_uploaded_by")
  @@index([comment_id], map: "task_attachment_comment_id")
}

model task_checklist {
  id         Int                   @id @default(autoincrement())
  title      String                @db.VarChar(255)
  sort_order Int                   @default(0)
  task_id    Int
  created_at DateTime              @db.DateTime(0)
  updated_at DateTime              @db.DateTime(0)
  task       task                  @relation(fields: [task_id], references: [id], onDelete: Cascade)
  items      task_checklist_item[]

  @@index([task_id], map: "task_checklist_task_id")
}

model task_checklist_item {
  id           Int            @id @default(autoincrement())
  title        String         @db.VarChar(255)
  is_completed Boolean        @default(false)
  sort_order   Int            @default(0)
  checklist_id Int
  completed_by Int?
  completed_at DateTime?      @db.DateTime(0)
  created_at   DateTime       @db.DateTime(0)
  updated_at   DateTime       @db.DateTime(0)
  checklist    task_checklist @relation(fields: [checklist_id], references: [id], onDelete: Cascade)
  user         user?          @relation(fields: [completed_by], references: [id])

  @@index([checklist_id], map: "task_checklist_item_checklist_id")
  @@index([completed_by], map: "task_checklist_item_completed_by")
}

model task_activity {
  id         Int      @id @default(autoincrement())
  action     String   @db.VarChar(50)
  field      String?  @db.VarChar(100)
  old_value  String?  @db.Text
  new_value  String?  @db.Text
  task_id    Int
  user_id    Int
  created_at DateTime @db.DateTime(0)
  task       task     @relation(fields: [task_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([task_id], map: "task_activity_task_id")
  @@index([user_id], map: "task_activity_user_id")
}

model task_time_entry {
  id          Int       @id @default(autoincrement())
  task_id     Int
  user_id     Int
  description String?   @db.VarChar(500)
  hours       Decimal   @db.Decimal(8, 2)
  date        DateTime  @db.Date
  started_at  DateTime? @db.DateTime(0)
  ended_at    DateTime? @db.DateTime(0)
  is_billable Boolean   @default(false)
  created_at  DateTime  @db.DateTime(0)
  updated_at  DateTime  @db.DateTime(0)
  task        task      @relation(fields: [task_id], references: [id], onDelete: Cascade)
  user        user      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([task_id], map: "task_time_entry_task_id")
  @@index([user_id], map: "task_time_entry_user_id")
  @@index([date], map: "task_time_entry_date")
}

model task_template {
  id              Int           @id @default(autoincrement())
  name            String        @db.VarChar(255)
  description     String?       @db.Text
  priority        task_priority @default(MEDIUM)
  checklist_json  String?       @db.Text
  subtasks_json   String?       @db.Text
  estimated_hours Int?
  is_global       Boolean       @default(false)
  project_id      Int?
  created_by      Int
  created_at      DateTime      @db.DateTime(0)
  updated_at      DateTime      @db.DateTime(0)
  creator         user          @relation(fields: [created_by], references: [id], onDelete: Cascade)
  project         project?      @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([project_id], map: "task_template_project_id")
  @@index([created_by], map: "task_template_created_by")
}

model task_dependency {
  id              Int      @id @default(autoincrement())
  task_id         Int
  depends_on_id   Int
  dependency_type String   @default("BLOCKS") @db.VarChar(50)
  created_at      DateTime @db.DateTime(0)
  created_by      Int?
  creator         user?    @relation(fields: [created_by], references: [id])
  depends_on      task     @relation("TaskDependedBy", fields: [depends_on_id], references: [id], onDelete: Cascade)
  task            task     @relation("TaskDependencies", fields: [task_id], references: [id], onDelete: Cascade)

  @@unique([task_id, depends_on_id])
  @@index([task_id], map: "task_dependency_task_id")
  @@index([depends_on_id], map: "task_dependency_depends_on_id")
  @@index([created_by], map: "task_dependency_created_by")
}

model user {
  id                                                    Int                        @id @default(autoincrement())
  username                                              String                     @unique(map: "user_username_unique") @db.VarChar(255)
  password                                              String                     @db.VarChar(255)
  full_name                                             String                     @db.VarChar(255)
  role                                                  UserRole
  role_id                                               Int?
  active                                                Boolean                    @default(true)
  department_id                                         Int?
  work_email                                            String?                    @db.VarChar(255)
  hire_date                                             DateTime?                  @db.DateTime(0)
  termination_date                                      DateTime?                  @db.DateTime(0)
  profile_photo_url                                     String?                    @db.VarChar(255)
  manager_user_id                                       Int?
  position_id                                           Int?
  created_at                                            DateTime                   @db.DateTime(0)
  updated_at                                            DateTime                   @db.DateTime(0)
  announcements                                         announcement[]
  announcement_reads                                    announcement_read[]
  app_settings_updated                                  app_settings[]
  application                                           application[]
  attendance                                            attendance[]
  audit_logs                                            audit_log[]
  contracts_created                                     contract[]                 @relation("contract_creator")
  contracts                                             contract[]
  conversation                                          conversation[]
  conversation_participant                              conversation_participant[]
  department_department_manager_user_idTouser           department[]               @relation("department_manager_user_idTouser")
  department_announcement                               department_announcement[]
  employment_contract                                   employment_contract[]
  expense                                               expense[]
  expense_report_approver                               expense_report[]           @relation("expense_report_approver")
  expense_report_user                                   expense_report[]           @relation("expense_report_user")
  job                                                   job[]
  leave_balance                                         leave_balance[]
  leave_messages                                        leave_message[]            @relation("user_leave_messages")
  notifications                                         notification[]
  project                                               project[]
  project_member                                        project_member[]
  task_task_created_by_user_idTouser                    task[]                     @relation("task_created_by_user_idTouser")
  task_task_updated_by_user_idTouser                    task[]                     @relation("task_updated_by_user_idTouser")
  task_activities                                       task_activity[]
  task_assignment                                       task_assignment[]
  task_attachments                                      task_attachment[]
  task_checklist_items_completed                        task_checklist_item[]
  task_comments_authored                                task_comment[]             @relation("CommentAuthor")
  task_comments_resolved                                task_comment[]             @relation("CommentResolver")
  comment_reactions                                     comment_reaction[]         @relation("UserCommentReactions")
  comment_edits                                         comment_edit_history[]     @relation("UserCommentEdits")
  task_dependencies_created                             task_dependency[]
  task_templates_created                                task_template[]
  task_time_entries                                     task_time_entry[]
  department                                            department?                @relation("user_department_idTodepartment", fields: [department_id], references: [id], map: "user_ibfk_517")
  user                                                  user?                      @relation("userTouser", fields: [manager_user_id], references: [id], map: "user_ibfk_518")
  other_user                                            user[]                     @relation("userTouser")
  position                                              position?                  @relation(fields: [position_id], references: [id], map: "user_ibfk_519")
  role_relation                                         role?                      @relation(fields: [role_id], references: [id], map: "user_role_fk")
  user_document_user_document_uploaded_by_user_idTouser user_document[]            @relation("user_document_uploaded_by_user_idTouser")
  user_document_user_document_user_idTouser             user_document[]            @relation("user_document_user_idTouser")
  user_employment_history                               user_employment_history[]
  user_financial_info                                   user_financial_info[]
  user_message_user_message_sender_user_idTouser        user_message[]             @relation("user_message_sender_user_idTouser")
  user_message_user_message_recipient_user_idTouser     user_message[]             @relation("user_message_recipient_user_idTouser")
  user_personal_event                                   user_personal_event[]
  user_personal_info                                    user_personal_info[]
  user_role                                             user_role[]

  // Payroll relations
  payslips           payslip[]
  payslips_generated payslip[]          @relation("payslip_generator")
  salary_advances    salary_advance[]
  advances_reviewed  salary_advance[]   @relation("advance_reviewer")
  bonuses            bonus[]
  bonuses_created    bonus[]            @relation("bonus_creator")
  bonuses_approved   bonus[]            @relation("bonus_approver")
  employee_benefits  employee_benefit[]
  fund_requests        fund_request[]
  fund_requests_reviewed fund_request[] @relation("fund_request_reviewer")

  // Recruitment relations
  interviews_as_interviewer job_interview[]      @relation("Interviewer")
  onboarding_as_employee    onboarding_process?  @relation("OnboardingEmployee")
  onboarding_as_mentor      onboarding_process[] @relation("OnboardingMentor")
  mentions                  message_mention[]

  // Training & Development relations
  trainings_created            training[]              @relation("training_creator")
  training_registrations       training_registration[] @relation("training_participant")
  training_registrations_approved training_registration[] @relation("training_approver")
  user_certifications          user_certification[]    @relation("user_certifications")
  development_plans            development_plan[]      @relation("development_plan_user")
  development_plans_created    development_plan[]      @relation("development_plan_creator")
  elearning_progress           elearning_progress[]    @relation("elearning_user")

  @@index([department_id], map: "department_id")
  @@index([manager_user_id], map: "manager_user_id")
  @@index([position_id], map: "position_id")
  @@index([role_id], map: "user_role_fk")
}

model user_document {
  id                                           Int       @id @default(autoincrement())
  name                                         String    @db.VarChar(255)
  document_type                                String?   @db.VarChar(255)
  file_path                                    String    @db.VarChar(255)
  is_confidential                              Boolean   @default(false)
  uploaded_by_user_id                          Int
  description                                  String?   @db.Text
  expires_at                                   DateTime? @db.DateTime(0)
  created_at                                   DateTime  @db.DateTime(0)
  updated_at                                   DateTime  @db.DateTime(0)
  user_id                                      Int
  user_user_document_uploaded_by_user_idTouser user      @relation("user_document_uploaded_by_user_idTouser", fields: [uploaded_by_user_id], references: [id], onDelete: NoAction, map: "user_document_ibfk_1")
  user_user_document_user_idTouser             user      @relation("user_document_user_idTouser", fields: [user_id], references: [id], onDelete: Cascade, map: "user_document_ibfk_2")

  @@index([uploaded_by_user_id], map: "uploaded_by_user_id")
  @@index([user_id], map: "user_id")
}

model user_employment_history {
  id             Int      @id @default(autoincrement())
  change_type    String   @db.VarChar(255)
  effective_date DateTime @db.DateTime(0)
  notes          String?  @db.Text
  created_at     DateTime @db.DateTime(0)
  updated_at     DateTime @db.DateTime(0)
  user_id        Int
  user           user     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "user_employment_history_ibfk_1")

  @@index([user_id], map: "user_id")
}

model user_financial_info {
  id                       Int                                  @id @default(autoincrement())
  employment_type          user_financial_info_employment_type?
  salary_basic             Int?
  salary_gross             Int?
  salary_net               Int?
  allowance_house_rent     Int?
  allowance_medical        Int?
  allowance_special        Int?
  allowance_fuel           Int?
  allowance_phone_bill     Int?
  allowance_other          Int?
  allowance_total          Int?
  deduction_provident_fund Int?
  deduction_tax            Int?
  deduction_other          Int?
  deduction_total          Int?
  bank_name                String?                              @db.VarChar(255)
  account_name             String?                              @db.VarChar(255)
  account_number           String?                              @db.VarChar(255)
  iban                     String?                              @db.VarChar(255)
  user_id                  Int
  user                     user                                 @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "user_financial_info_ibfk_1")

  @@index([user_id], map: "user_id")
}

model user_message {
  id                                        Int           @id @default(autoincrement())
  text                                      String        @db.Text
  sender_user_id                            Int
  recipient_user_id                         Int?
  conversation_id                           Int?
  is_read                                   Boolean       @default(false)
  read_at                                   DateTime?     @db.DateTime(0)
  created_at                                DateTime      @db.DateTime(0)
  updated_at                                DateTime      @db.DateTime(0)
  user_user_message_sender_user_idTouser    user          @relation("user_message_sender_user_idTouser", fields: [sender_user_id], references: [id], onDelete: Cascade, map: "user_message_ibfk_436")
  user_user_message_recipient_user_idTouser user?         @relation("user_message_recipient_user_idTouser", fields: [recipient_user_id], references: [id], map: "user_message_ibfk_437")
  conversation                              conversation? @relation(fields: [conversation_id], references: [id], onDelete: Cascade, map: "user_message_ibfk_438")

  @@index([conversation_id], map: "conversation_id")
  @@index([recipient_user_id], map: "recipient_user_id")
  @@index([sender_user_id], map: "sender_user_id")
  attachments                               message_attachment[]
  mentions                                  message_mention[]
}

model message_attachment {
  id          Int          @id @default(autoincrement())
  message_id  Int
  file_name   String       @db.VarChar(255)
  file_path   String       @db.VarChar(500)
  file_type   String       @db.VarChar(100)
  mime_type   String       @db.VarChar(100)
  file_size   Int
  created_at  DateTime     @default(now())
  message     user_message @relation(fields: [message_id], references: [id], onDelete: Cascade)

  @@index([message_id])
}

model message_mention {
  id          Int          @id @default(autoincrement())
  message_id  Int
  user_id     Int
  created_at  DateTime     @default(now())
  message     user_message @relation(fields: [message_id], references: [id], onDelete: Cascade)
  user        user         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([message_id])
}

model user_personal_event {
  id                Int       @id @default(autoincrement())
  event_title       String    @db.VarChar(255)
  event_description String?   @db.VarChar(255)
  event_start_date  DateTime  @db.DateTime(0)
  event_end_date    DateTime? @db.DateTime(0)
  user_id           Int
  user              user      @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "user_personal_event_ibfk_1")

  @@index([user_id], map: "user_id")
}

model user_personal_info {
  id                                   Int                                @id @default(autoincrement())
  date_of_birth                        DateTime?                          @db.DateTime(0)
  gender                               user_personal_info_gender?
  marital_status                       user_personal_info_marital_status?
  father_name                          String?                            @db.VarChar(255)
  id_number                            String?                            @db.VarChar(255)
  address                              String?                            @db.VarChar(255)
  city                                 String?                            @db.VarChar(255)
  country                              String?                            @db.VarChar(255)
  mobile                               String?                            @db.VarChar(255)
  phone                                String?                            @db.VarChar(255)
  email_address                        String?                            @db.VarChar(255)
  spouse_name                          String?                            @db.VarChar(255)
  emergency_contact_primary_name       String?                            @db.VarChar(255)
  emergency_contact_primary_phone      String?                            @db.VarChar(100)
  emergency_contact_primary_relation   String?                            @db.VarChar(255)
  emergency_contact_secondary_name     String?                            @db.VarChar(255)
  emergency_contact_secondary_phone    String?                            @db.VarChar(100)
  emergency_contact_secondary_relation String?                            @db.VarChar(255)
  user_id                              Int
  user                                 user                               @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "user_personal_info_ibfk_1")

  @@index([user_id], map: "user_id")
}

model user_role {
  id         Int      @id @default(autoincrement())
  created_at DateTime @db.DateTime(0)
  updated_at DateTime @db.DateTime(0)
  user_id    Int?
  role_id    Int?
  user       user?    @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "user_role_ibfk_123")
  role       role?    @relation(fields: [role_id], references: [id], onDelete: Cascade, map: "user_role_ibfk_124")

  @@unique([user_id, role_id], map: "user_role_role_id_user_id_unique")
  @@index([role_id], map: "role_id")
}

model attendance {
  id                 Int               @id @default(autoincrement())
  user_id            Int
  date               DateTime          @db.Date
  check_in           DateTime?         @db.DateTime(0)
  check_out          DateTime?         @db.DateTime(0)
  check_in_location  String?           @db.VarChar(255)
  check_out_location String?           @db.VarChar(255)
  status             attendance_status @default(PRESENT)
  notes              String?           @db.Text
  worked_hours       Float?            @db.Float
  overtime_hours     Float?            @db.Float
  created_at         DateTime          @default(now()) @db.DateTime(0)
  updated_at         DateTime          @updatedAt @db.DateTime(0)
  user               user              @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, date], map: "attendance_user_date_unique")
  @@index([user_id], map: "attendance_user_id")
  @@index([date], map: "attendance_date")
}

model expense_report {
  id              Int                     @id @default(autoincrement())
  user_id         Int
  title           String                  @db.VarChar(255)
  description     String?                 @db.Text
  amount          Decimal                 @db.Decimal(10, 2)
  currency        String                  @default("USD") @db.VarChar(3)
  category        expense_report_category
  expense_date    DateTime                @db.Date
  receipt_url     String?                 @db.VarChar(500)
  status          expense_report_status   @default(DRAFT)
  submitted_at    DateTime?               @db.DateTime(0)
  approved_by     Int?
  approved_at     DateTime?               @db.DateTime(0)
  rejected_reason String?                 @db.Text
  payment_date    DateTime?               @db.Date
  payment_ref     String?                 @db.VarChar(100)
  created_at      DateTime                @default(now()) @db.DateTime(0)
  updated_at      DateTime                @updatedAt @db.DateTime(0)
  approver        user?                   @relation("expense_report_approver", fields: [approved_by], references: [id])
  user            user                    @relation("expense_report_user", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id], map: "expense_report_user_id")
  @@index([status], map: "expense_report_status")
  @@index([expense_date], map: "expense_report_date")
  @@index([approved_by], map: "expense_report_approved_by_fkey")
}

model contract {
  id              Int             @id @default(autoincrement())
  user_id         Int
  contract_type   contract_type
  start_date      DateTime        @db.Date
  end_date        DateTime?       @db.Date
  salary          Decimal?        @db.Decimal(12, 2)
  salary_currency String          @default("USD") @db.VarChar(3)
  working_hours   Float?          @db.Float
  probation_end   DateTime?       @db.Date
  status          contract_status @default(ACTIVE)
  document_url    String?         @db.VarChar(500)
  notes           String?         @db.Text
  created_by      Int?
  created_at      DateTime        @default(now()) @db.DateTime(0)
  updated_at      DateTime        @updatedAt @db.DateTime(0)
  creator         user?           @relation("contract_creator", fields: [created_by], references: [id])
  user            user            @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id], map: "contract_user_id")
  @@index([status], map: "contract_status")
  @@index([end_date], map: "contract_end_date")
  @@index([created_by], map: "contract_created_by_fkey")
}

model announcement {
  id            Int                   @id @default(autoincrement())
  title         String                @db.VarChar(255)
  content       String                @db.Text
  type          announcement_type     @default(INFO)
  priority      announcement_priority @default(NORMAL)
  is_published  Boolean               @default(false)
  publish_date  DateTime?             @db.DateTime(0)
  expire_date   DateTime?             @db.DateTime(0)
  target_all    Boolean               @default(true)
  author_id     Int
  department_id Int?
  created_at    DateTime              @default(now()) @db.DateTime(0)
  updated_at    DateTime              @updatedAt @db.DateTime(0)
  author        user                  @relation(fields: [author_id], references: [id], onDelete: Cascade)
  department    department?           @relation(fields: [department_id], references: [id])
  reads         announcement_read[]

  @@index([author_id], map: "announcement_author_id")
  @@index([department_id], map: "announcement_department_id")
  @@index([is_published], map: "announcement_published")
  @@index([publish_date], map: "announcement_publish_date")
}

model announcement_read {
  id              Int          @id @default(autoincrement())
  announcement_id Int
  user_id         Int
  read_at         DateTime     @default(now()) @db.DateTime(0)
  announcement    announcement @relation(fields: [announcement_id], references: [id], onDelete: Cascade)
  user            user         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([announcement_id, user_id])
  @@index([user_id], map: "announcement_read_user_id")
}

model tag {
  id           Int           @id @default(autoincrement())
  name         String        @unique(map: "tag_name_unique") @db.VarChar(50)
  color        String        @default("#6B7280") @db.VarChar(7)
  created_at   DateTime      @default(now()) @db.DateTime(0)
  updated_at   DateTime      @updatedAt @db.DateTime(0)
  project_tags project_tag[]
  task_tags    task_tag[]
}

model project_tag {
  id         Int      @id @default(autoincrement())
  project_id Int
  tag_id     Int
  created_at DateTime @default(now()) @db.DateTime(0)
  project    project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
  tag        tag      @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@unique([project_id, tag_id], map: "project_tag_unique")
  @@index([project_id], map: "project_tag_project_id")
  @@index([tag_id], map: "project_tag_tag_id")
}

model task_tag {
  id         Int      @id @default(autoincrement())
  task_id    Int
  tag_id     Int
  created_at DateTime @default(now()) @db.DateTime(0)
  tag        tag      @relation(fields: [tag_id], references: [id], onDelete: Cascade)
  task       task     @relation(fields: [task_id], references: [id], onDelete: Cascade)

  @@unique([task_id, tag_id], map: "task_tag_unique")
  @@index([task_id], map: "task_tag_task_id")
  @@index([tag_id], map: "task_tag_tag_id")
}

model app_settings {
  id          Int      @id @default(autoincrement())
  key         String   @unique @db.VarChar(100)
  value       String?  @db.Text
  type        String   @default("string") @db.VarChar(50)
  category    String   @default("general") @db.VarChar(50)
  label       String   @db.VarChar(255)
  description String?  @db.Text
  is_public   Boolean  @default(false)
  updated_by  Int?
  created_at  DateTime @default(now()) @db.DateTime(0)
  updated_at  DateTime @updatedAt @db.DateTime(0)
  updater     user?    @relation(fields: [updated_by], references: [id])

  @@index([category], map: "app_settings_category")
  @@index([is_public], map: "app_settings_public")
  @@index([updated_by], map: "app_settings_updated_by_fkey")
}

model audit_log {
  id          Int      @id @default(autoincrement())
  user_id     Int?
  action      String   @db.VarChar(50)
  entity_type String   @db.VarChar(100)
  entity_id   Int?
  old_values  String?  @db.Text
  new_values  String?  @db.Text
  ip_address  String?  @db.VarChar(45)
  user_agent  String?  @db.VarChar(500)
  created_at  DateTime @default(now()) @db.DateTime(0)
  user        user?    @relation(fields: [user_id], references: [id])

  @@index([user_id], map: "audit_log_user_id")
  @@index([action], map: "audit_log_action")
  @@index([entity_type], map: "audit_log_entity_type")
  @@index([created_at], map: "audit_log_created_at")
}

model notification {
  id          Int               @id @default(autoincrement())
  user_id     Int
  type        notification_type
  title       String            @db.VarChar(255)
  message     String            @db.Text
  link        String?           @db.VarChar(500)
  entity_type String?           @db.VarChar(50)
  entity_id   Int?
  is_read     Boolean           @default(false)
  read_at     DateTime?         @db.DateTime(0)
  created_at  DateTime          @default(now()) @db.DateTime(0)
  user        user              @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id], map: "notification_user_id")
  @@index([is_read], map: "notification_is_read")
  @@index([created_at], map: "notification_created_at")
  @@index([type], map: "notification_type")
}

// ========================================
// PAYROLL MODELS
// ========================================

model payslip {
  id                Int      @id @default(autoincrement())
  user_id           Int
  month             Int // 1-12
  year              Int // 2024, 2025, etc.
  salary_basic      Decimal  @db.Decimal(10, 2)
  salary_gross      Decimal  @db.Decimal(10, 2)
  salary_net        Decimal  @db.Decimal(10, 2)
  allowances_total  Decimal  @db.Decimal(10, 2)
  deductions_total  Decimal  @db.Decimal(10, 2)
  bonuses_total     Decimal? @db.Decimal(10, 2)
  advances_deducted Decimal? @db.Decimal(10, 2)

  // Details JSON - store breakdown of allowances, deductions, bonuses
  allowances_breakdown Json?
  deductions_breakdown Json?
  bonuses_breakdown    Json?

  // Metadata
  status       payslip_status @default(DRAFT)
  generated_by Int
  generated_at DateTime       @default(now()) @db.DateTime(0)
  published_at DateTime?      @db.DateTime(0)
  pdf_path     String?        @db.VarChar(500)
  notes        String?        @db.Text

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  user      user @relation(fields: [user_id], references: [id], onDelete: Cascade)
  generator user @relation("payslip_generator", fields: [generated_by], references: [id])

  @@unique([user_id, month, year])
  @@index([user_id], map: "payslip_user_id")
  @@index([status], map: "payslip_status")
  @@index([month, year], map: "payslip_period")
  @@index([generated_by], map: "payslip_generator")
}

model salary_advance {
  id             Int       @id @default(autoincrement())
  user_id        Int
  amount         Decimal   @db.Decimal(10, 2)
  reason         String    @db.Text
  requested_date DateTime  @default(now()) @db.DateTime(0)
  needed_by_date DateTime? @db.Date

  // Approval workflow
  status           advance_status @default(DRAFT)
  submitted_at     DateTime?      @db.DateTime(0)
  reviewed_by      Int?
  reviewed_at      DateTime?      @db.DateTime(0)
  reviewer_comment String?        @db.Text

  // Repayment
  repayment_months  Int? // Number of months to repay
  monthly_deduction Decimal?  @db.Decimal(10, 2)
  total_repaid      Decimal   @default(0) @db.Decimal(10, 2)
  repayment_start   DateTime? @db.Date
  fully_repaid_at   DateTime? @db.DateTime(0)

  // Payment
  paid_at           DateTime? @db.DateTime(0)
  payment_method    String?   @db.VarChar(50)
  payment_reference String?   @db.VarChar(100)

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  user       user                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  reviewer   user?               @relation("advance_reviewer", fields: [reviewed_by], references: [id])
  repayments advance_repayment[]

  @@index([user_id], map: "salary_advance_user_id")
  @@index([status], map: "salary_advance_status")
  @@index([reviewed_by], map: "salary_advance_reviewer")
}

model advance_repayment {
  id            Int      @id @default(autoincrement())
  advance_id    Int
  payslip_month Int
  payslip_year  Int
  amount        Decimal  @db.Decimal(10, 2)
  deducted_at   DateTime @default(now()) @db.DateTime(0)

  advance salary_advance @relation(fields: [advance_id], references: [id], onDelete: Cascade)

  @@index([advance_id], map: "advance_repayment_advance_id")
}

// --- FUND REQUEST MODEL ---
model fund_request {
  id          Int                 @id @default(autoincrement())
  user_id     Int
  amount      Decimal             @db.Decimal(10, 2)
  reason      String              @db.Text
  project     String?             @db.VarChar(255)
  department  String?             @db.VarChar(255)
  needed_by   DateTime?           @db.Date
  
  // Workflow
  status           fund_request_status @default(DRAFT)
  submitted_at     DateTime?           @db.DateTime(0)
  reviewed_by      Int?
  reviewed_at      DateTime?           @db.DateTime(0)
  reviewer_comment String?             @db.Text
  
  // Payment tracking
  paid_at          DateTime?           @db.DateTime(0)
  payment_method   String?             @db.VarChar(50)
  payment_ref      String?             @db.VarChar(100)
  
  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)
  
  user     user  @relation(fields: [user_id], references: [id], onDelete: Cascade)
  reviewer user? @relation("fund_request_reviewer", fields: [reviewed_by], references: [id])
  
  @@index([user_id], map: "fund_request_user_id")
  @@index([status], map: "fund_request_status")
  @@index([reviewed_by], map: "fund_request_reviewer")
}

model bonus {
  id          Int        @id @default(autoincrement())
  user_id     Int
  bonus_type  bonus_type
  amount      Decimal    @db.Decimal(10, 2)
  title       String     @db.VarChar(255)
  description String?    @db.Text
  period      String?    @db.VarChar(100) // e.g., "Q4 2024", "Janvier 2025"

  // Approval workflow
  status           bonus_status @default(DRAFT)
  created_by       Int
  submitted_at     DateTime?    @db.DateTime(0)
  approved_by      Int?
  approved_at      DateTime?    @db.DateTime(0)
  approver_comment String?      @db.Text

  // Payment
  payslip_month Int? // Month included in payslip
  payslip_year  Int? // Year included in payslip
  paid_at       DateTime? @db.DateTime(0)

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  user     user  @relation(fields: [user_id], references: [id], onDelete: Cascade)
  creator  user  @relation("bonus_creator", fields: [created_by], references: [id])
  approver user? @relation("bonus_approver", fields: [approved_by], references: [id])

  @@index([user_id], map: "bonus_user_id")
  @@index([status], map: "bonus_status")
  @@index([bonus_type], map: "bonus_type")
  @@index([created_by], map: "bonus_creator")
  @@index([approved_by], map: "bonus_approver")
}

model benefit_catalog {
  id               Int                @id @default(autoincrement())
  name             String             @db.VarChar(255)
  description      String             @db.Text
  benefit_type     benefit_type
  value_type       benefit_value_type // FIXED, PERCENTAGE
  value_amount     Decimal?           @db.Decimal(10, 2)
  value_percentage Decimal?           @db.Decimal(5, 2)

  // Eligibility
  is_active           Boolean @default(true)
  requires_enrollment Boolean @default(true)
  eligibility_rules   Json? // {'min_tenure_months': 6, 'roles': ['ROLE_EMPLOYEE']}

  // Cost
  employer_contribution Decimal? @db.Decimal(10, 2)
  employee_contribution Decimal? @db.Decimal(10, 2)

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  enrollments employee_benefit[]

  @@index([benefit_type], map: "benefit_catalog_type")
  @@index([is_active], map: "benefit_catalog_active")
}

model employee_benefit {
  id         Int @id @default(autoincrement())
  user_id    Int
  benefit_id Int

  // Enrollment
  enrolled_at DateTime                  @default(now()) @db.DateTime(0)
  start_date  DateTime                  @db.Date
  end_date    DateTime?                 @db.Date
  status      benefit_enrollment_status @default(ACTIVE)

  // Custom values (if different from catalog)
  custom_value Decimal? @db.Decimal(10, 2)

  // Tracking
  last_used_at DateTime? @db.DateTime(0)
  usage_count  Int       @default(0)
  notes        String?   @db.Text

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  user    user            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  benefit benefit_catalog @relation(fields: [benefit_id], references: [id], onDelete: Cascade)

  @@unique([user_id, benefit_id])
  @@index([user_id], map: "employee_benefit_user_id")
  @@index([benefit_id], map: "employee_benefit_benefit_id")
  @@index([status], map: "employee_benefit_status")
}

// ========================================
// ENUMS
// ========================================

enum employment_contract_contract_type {
  PERMANENT
  FIXED_TERM
  INTERNSHIP
  CONTRACTOR
}

enum payment_payment_type {
  Check
  Bank_Transfer @map("Bank Transfer")
  Cash
}

enum user_financial_info_employment_type {
  Full_Time @map("Full Time")
  Part_Time @map("Part Time")
}

enum user_personal_info_gender {
  Male
  Female
}

enum project_status {
  PLANNED
  ACTIVE
  ON_HOLD
  COMPLETED
  ARCHIVED
}

enum task_status {
  TODO
  IN_PROGRESS
  BLOCKED
  DONE
  ARCHIVED
}

enum user_personal_info_marital_status {
  Married
  Single
  Widowed
}

enum application_status {
  Approved
  Rejected
  Pending
  Cancelled
}

enum task_priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum UserRole {
  ROLE_ADMIN
  ROLE_MANAGER
  ROLE_EMPLOYEE
  ROLE_SUPER_ADMIN
  ROLE_RH
}

enum application_type {
  CongePaye    @map("Cong Pay")
  Maladie
  TeleTravail  @map("TlTravail")
  Marriage
  Permission
  Abscence
  Demenagement @map("Dmnagement")
  Deces        @map("Dcs")
}

enum employment_contract_status {
  DRAFT
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum attendance_status {
  PRESENT
  ABSENT
  LATE
  HALF_DAY
  REMOTE
  ON_LEAVE
}

enum expense_report_category {
  TRANSPORT
  MEALS
  ACCOMMODATION
  OFFICE_SUPPLIES
  EQUIPMENT
  TRAINING
  TRAVEL
  CLIENT_ENTERTAINMENT
  COMMUNICATION
  OTHER
}

enum expense_report_status {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PAID
  CANCELLED
}

enum contract_type {
  CDI
  CDD
  INTERIM
  STAGE
  APPRENTISSAGE
  FREELANCE
  OTHER
}

enum contract_status {
  DRAFT
  ACTIVE
  SUSPENDED
  TERMINATED
  EXPIRED
}

enum announcement_type {
  INFO
  EVENT
  POLICY
  CELEBRATION
  URGENT
  MAINTENANCE
}

enum announcement_priority {
  LOW
  NORMAL
  HIGH
  CRITICAL
}

enum notification_type {
  PROJECT_ADDED
  PROJECT_REMOVED
  TASK_ASSIGNED
  TASK_UNASSIGNED
  TASK_UPDATED
  TASK_COMPLETED
  TASK_COMMENT
  TASK_DUE
  LEAVE_APPROVED
  LEAVE_REJECTED
  LEAVE_PENDING
  ANNOUNCEMENT
  MESSAGE
  MENTION
  SYSTEM
  FUND_REQUEST_SUBMITTED
  FUND_REQUEST_APPROVED
  FUND_REQUEST_REJECTED
  FUND_REQUEST_PAID
  TRAINING_APPROVED
  TRAINING_REJECTED
  ELEARNING_BADGE_EARNED
  TRAINING_REGISTERED
}

// Payroll enums
enum payslip_status {
  DRAFT
  PUBLISHED
  SENT
  ARCHIVED
}

enum advance_status {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PAID
  REPAYING
  COMPLETED
  CANCELLED
}

enum fund_request_status {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PAID
  CANCELLED
}

enum bonus_type {
  PERFORMANCE
  ANNUAL
  EXCEPTIONAL
  PROJECT_COMPLETION
  RETENTION
  REFERRAL
}

enum bonus_status {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PAID
  CANCELLED
}

enum benefit_type {
  HEALTH_INSURANCE
  MEAL_VOUCHERS
  TRANSPORT
  PHONE
  GYM
  TRAINING
  REMOTE_WORK
  OTHER
}

enum benefit_value_type {
  FIXED
  PERCENTAGE
}

enum benefit_enrollment_status {
  PENDING
  ACTIVE
  SUSPENDED
  TERMINATED
}

// --- RECRUITMENT MODULE MODELS ---

model job_offer {
  id            Int       @id @default(autoincrement())
  title         String    @db.VarChar(255)
  description   String?   @db.Text
  department    String    @db.VarChar(255)
  location      String    @db.VarChar(255)
  contract_type String    @db.VarChar(50)
  status        String    @default("DRAFT") @db.VarChar(50)
  posted_date   DateTime? @db.Date

  // Scoring fields
  required_skills  Json? // Liste des comptences requises
  min_experience   Int? // Annes d'exprience minimum
  scoring_criteria Json? // Critres personnaliss {skills: 40, experience: 25, interview: 20, rating: 15}

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  applications candidate_application[]
}

model candidate {
  id           Int     @id @default(autoincrement())
  first_name   String  @db.VarChar(255)
  last_name    String  @db.VarChar(255)
  email        String  @unique @db.VarChar(255)
  phone        String? @db.VarChar(50)
  cv_url       String? @db.VarChar(500)
  linkedin_url String? @db.VarChar(500)

  rating           Int   @default(0)
  skills           Json?
  years_experience Int   @default(0) // Annes d'exprience du candidat

  is_in_talent_pool Boolean @default(false)

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  applications candidate_application[]
  interviews   job_interview[]
}

model candidate_application {
  id           Int @id @default(autoincrement())
  job_offer_id Int
  candidate_id Int

  status String @default("NEW") @db.VarChar(50)
  stage  String @default("NEW") @db.VarChar(50)

  // Scoring fields
  score           Int? // Score global calcul (0-100)
  score_breakdown Json? // Dtail: {skills: 85, experience: 70, interview: 90, rating: 75}
  scored_at       DateTime? @db.DateTime(0) // Date du dernier calcul

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  job_offer  job_offer       @relation(fields: [job_offer_id], references: [id], onDelete: Cascade)
  candidate  candidate       @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  interviews job_interview[]

  @@index([job_offer_id])
  @@index([candidate_id])
}

model job_interview {
  id             Int @id @default(autoincrement())
  application_id Int
  candidate_id   Int

  interview_date DateTime @db.DateTime(0)
  interviewer_id Int
  type           String   @default("VISIO") @db.VarChar(50)
  status         String   @default("SCHEDULED") @db.VarChar(50)
  rating         Int?
  feedback       String?  @db.Text

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  application candidate_application @relation(fields: [application_id], references: [id], onDelete: Cascade)
  candidate   candidate             @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  interviewer user                  @relation("Interviewer", fields: [interviewer_id], references: [id])

  @@index([application_id])
  @@index([candidate_id])
  @@index([interviewer_id])
}

model onboarding_process {
  id          Int  @id @default(autoincrement())
  employee_id Int  @unique
  mentor_id   Int?

  status     String   @default("PRE_BOARDING") @db.VarChar(50)
  start_date DateTime @db.Date

  checklist Json?

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  employee user  @relation("OnboardingEmployee", fields: [employee_id], references: [id], onDelete: Cascade)
  mentor   user? @relation("OnboardingMentor", fields: [mentor_id], references: [id])

  @@index([mentor_id])
}

// ============================================
// TRAINING & DEVELOPMENT MODULE
// ============================================

model training_category {
  id          Int                @id @default(autoincrement())
  name        String             @db.VarChar(255)
  description String?            @db.Text
  icon        String?            @db.VarChar(10)
  color       String?            @db.VarChar(7)
  is_active   Boolean            @default(true)
  created_at  DateTime           @default(now()) @db.DateTime(0)
  updated_at  DateTime           @updatedAt @db.DateTime(0)
  trainings   training[]
  elearning_modules elearning_module[]
}

model training {
  id                 Int                     @id @default(autoincrement())
  title              String                  @db.VarChar(255)
  description        String?                 @db.Text
  category_id        Int
  level              training_level          @default(BEGINNER)
  duration_hours     Int
  max_participants   Int?
  is_mandatory       Boolean                 @default(false)
  is_online          Boolean                 @default(false)
  is_active          Boolean                 @default(true)
  instructor_name    String?                 @db.VarChar(255)
  location           String?                 @db.VarChar(255)
  prerequisites      String?                 @db.Text
  objectives         String?                 @db.Text
  image_url          String?                 @db.VarChar(500)
  created_by_user_id Int
  created_at         DateTime                @default(now()) @db.DateTime(0)
  updated_at         DateTime                @updatedAt @db.DateTime(0)
  category           training_category       @relation(fields: [category_id], references: [id])
  creator            user                    @relation("training_creator", fields: [created_by_user_id], references: [id])
  sessions           training_session[]
  registrations      training_registration[]

  @@index([category_id])
  @@index([created_by_user_id])
}

model training_session {
  id            Int                     @id @default(autoincrement())
  training_id   Int
  start_date    DateTime                @db.DateTime(0)
  end_date      DateTime                @db.DateTime(0)
  location      String?                 @db.VarChar(255)
  max_participants Int?
  status        session_status          @default(SCHEDULED)
  notes         String?                 @db.Text
  created_at    DateTime                @default(now()) @db.DateTime(0)
  updated_at    DateTime                @updatedAt @db.DateTime(0)
  training      training                @relation(fields: [training_id], references: [id], onDelete: Cascade)
  registrations training_registration[]

  @@index([training_id])
}

model training_registration {
  id             Int                 @id @default(autoincrement())
  user_id        Int
  training_id    Int
  session_id     Int?
  status         registration_status @default(PENDING)
  requested_at   DateTime            @default(now()) @db.DateTime(0)
  approved_at    DateTime?           @db.DateTime(0)
  approved_by_id Int?
  completed_at   DateTime?           @db.DateTime(0)
  score          Decimal?            @db.Decimal(5, 2)
  feedback       String?             @db.Text
  certificate_id Int?
  notes          String?             @db.Text
  created_at     DateTime            @default(now()) @db.DateTime(0)
  updated_at     DateTime            @updatedAt @db.DateTime(0)
  user           user                @relation("training_participant", fields: [user_id], references: [id], onDelete: Cascade)
  training       training            @relation(fields: [training_id], references: [id])
  session        training_session?   @relation(fields: [session_id], references: [id])
  approved_by    user?               @relation("training_approver", fields: [approved_by_id], references: [id])
  certificate    certification?      @relation(fields: [certificate_id], references: [id])

  @@unique([user_id, training_id, session_id])
  @@index([training_id])
  @@index([session_id])
  @@index([approved_by_id])
  @@index([certificate_id])
}

model certification {
  id                  Int                     @id @default(autoincrement())
  name                String                  @db.VarChar(255)
  issuing_org         String?                 @db.VarChar(255)
  description         String?                 @db.Text
  validity_months     Int?
  is_active           Boolean                 @default(true)
  created_at          DateTime                @default(now()) @db.DateTime(0)
  updated_at          DateTime                @updatedAt @db.DateTime(0)
  user_certifications user_certification[]
  registrations       training_registration[]
}

model user_certification {
  id               Int           @id @default(autoincrement())
  user_id          Int
  certification_id Int
  obtained_date    DateTime      @db.DateTime(0)
  expiry_date      DateTime?     @db.DateTime(0)
  credential_id    String?       @db.VarChar(255)
  credential_url   String?       @db.VarChar(500)
  status           cert_status   @default(ACTIVE)
  notes            String?       @db.Text
  created_at       DateTime      @default(now()) @db.DateTime(0)
  updated_at       DateTime      @updatedAt @db.DateTime(0)
  user             user          @relation("user_certifications", fields: [user_id], references: [id], onDelete: Cascade)
  certification    certification @relation(fields: [certification_id], references: [id])

  @@unique([user_id, certification_id, obtained_date])
  @@index([certification_id])
}

model development_plan {
  id            Int                     @id @default(autoincrement())
  user_id       Int
  title         String                  @db.VarChar(255)
  description   String?                 @db.Text
  start_date    DateTime                @db.DateTime(0)
  target_date   DateTime?               @db.DateTime(0)
  status        plan_status             @default(DRAFT)
  created_by_id Int
  created_at    DateTime                @default(now()) @db.DateTime(0)
  updated_at    DateTime                @updatedAt @db.DateTime(0)
  user          user                    @relation("development_plan_user", fields: [user_id], references: [id], onDelete: Cascade)
  creator       user                    @relation("development_plan_creator", fields: [created_by_id], references: [id])
  objectives    development_objective[]

  @@index([user_id])
  @@index([created_by_id])
}

model development_objective {
  id           Int                @id @default(autoincrement())
  plan_id      Int
  title        String             @db.VarChar(255)
  description  String?            @db.Text
  skill_area   String?            @db.VarChar(255)
  priority     objective_priority @default(MEDIUM)
  target_date  DateTime?          @db.DateTime(0)
  completed_at DateTime?          @db.DateTime(0)
  progress     Int                @default(0)
  status       objective_status   @default(NOT_STARTED)
  created_at   DateTime           @default(now()) @db.DateTime(0)
  updated_at   DateTime           @updatedAt @db.DateTime(0)
  plan         development_plan   @relation(fields: [plan_id], references: [id], onDelete: Cascade)

  @@index([plan_id])
}

model elearning_module {
  id               Int                  @id @default(autoincrement())
  title            String               @db.VarChar(255)
  description      String?              @db.Text
  content_url      String?              @db.VarChar(500)
  thumbnail_url    String?              @db.VarChar(500)
  duration_minutes Int
  level            training_level       @default(BEGINNER)
  category_id      Int?
  is_active        Boolean              @default(true)
  badge_name       String?              @db.VarChar(100)
  badge_icon       String?              @db.VarChar(10)
  created_at       DateTime             @default(now()) @db.DateTime(0)
  updated_at       DateTime             @updatedAt @db.DateTime(0)
  category         training_category?   @relation(fields: [category_id], references: [id])
  progress         elearning_progress[]

  @@index([category_id])
}

model elearning_progress {
  id               Int              @id @default(autoincrement())
  user_id          Int
  module_id        Int
  progress_percent Int              @default(0)
  status           elearning_status @default(NOT_STARTED)
  started_at       DateTime?        @db.DateTime(0)
  completed_at     DateTime?        @db.DateTime(0)
  last_accessed_at DateTime?        @db.DateTime(0)
  score            Decimal?         @db.Decimal(5, 2)
  badge_earned     Boolean          @default(false)
  created_at       DateTime         @default(now()) @db.DateTime(0)
  updated_at       DateTime         @updatedAt @db.DateTime(0)
  user             user             @relation("elearning_user", fields: [user_id], references: [id], onDelete: Cascade)
  module           elearning_module @relation(fields: [module_id], references: [id], onDelete: Cascade)

  @@unique([user_id, module_id])
  @@index([module_id])
}

// ============================================
// TRAINING MODULE ENUMS
// ============================================

enum training_level {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum session_status {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum registration_status {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  COMPLETED
  NO_SHOW
}

enum cert_status {
  ACTIVE
  EXPIRED
  REVOKED
}

enum plan_status {
  DRAFT
  ACTIVE
  COMPLETED
  CANCELLED
}

enum objective_status {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum objective_priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum elearning_status {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}
